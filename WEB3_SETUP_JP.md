# Universal Web3 Wallet - ウォレット拡張機能ガイド

## プロジェクト概要

これはEIP-1193標準を実装した完全なWeb3ウォレットブラウザ拡張機能で、DAppにイーサリアムプロバイダサービスを提供します。

## コア機能

### ✅ ウォレットプロバイダ機能
- **EIP-1193 Provider**: 標準イーサリアムプロバイダインターフェースの実装
- **DAppインジェクション**: すべてのWebページに`window.ethereum`オブジェクトをインジェクト
- **マルチネットワーク対応**: イーサリアムメインネットおよびその他のEVM互換ネットワークをサポート
- **標準互換性**: MetaMaskおよびその他のウォレットAPIとの互換性

### ✅ ウォレット管理機能
- **ニーモニック生成/インポート**: 12単語のBIP39ニーモニックフレーズをサポート
- **マルチアカウント管理**: HDウォレットベースの階層決定論的アカウント生成
- **パスワード暗号化**: ニーモニックフレーズと秘密鍵のローカル暗号化ストレージ
- **アカウント切り替え**: 複数のアカウント間での切り替えをサポート

### ✅ トランザクションと署名機能
- **トランザクション署名**: 標準イーサリアムトランザクション署名をサポート
- **メッセージ署名**: `personal_sign`メッセージ署名をサポート
- **型付きデータ署名**: `eth_signTypedData_v4`をサポート
- **トランザクション確認**: すべての署名およびトランザクション操作でポップアップ確認

### ✅ ユーザーインターフェース
- **Ant Design UI**: モダンなユーザーインターフェース
- **ウォレット状態管理**: ロック/アンロック状態管理
- **ネットワーク切り替え**: 異なるイーサリアムネットワーク間の切り替えをサポート
- **残高表示**: アカウント残高の照会と表示

## 技術アーキテクチャ

### コア依存関係
```json
{
  "ethers": "^6.15.0",           // トランザクションと署名用のイーサリアムライブラリ
  "bip39": "^3.1.0",            // ニーモニック生成と検証
  "@metamask/eth-sig-util": "^8.2.0", // 署名ユーティリティ
  "crypto-js": "^4.2.0",        // 暗号化ライブラリ
  "antd": "^5.27.4",            // UIコンポーネントライブラリ
  "webextension-polyfill": "^0.10.0" // ブラウザ拡張機能API互換レイヤー
}
```

### ファイル構造
```
src/
├── provider/
│   └── EthereumProvider.ts    # EIP-1193プロバイダ実装
├── wallet/
│   └── WalletManager.ts       # コアウォレット管理
├── content/
│   └── inject.ts              # インジェクションスクリプト
├── content.ts                 # コンテンツスクリプト
├── background.ts              # バックグラウンドスクリプト
├── pages/
│   └── Popup.tsx              # ウォレットUIインターフェース
├── popup.tsx                  # ポップアップエントリーポイント
└── manifest.json              # 拡張機能設定
```

## 開発とビルド

### 1. 依存関係のインストール
```bash
npm install
```

### 2. 開発モード
```bash
npm run dev
```

### 3. 拡張機能のビルド
```bash
npm run build
```

### 4. 拡張機能のロード
1. Chromeブラウザを開く
2. `chrome://extensions/`にナビゲート
3. 「デベロッパーモード」を有効化
4. 「パッケージ化されていない拡張機能を読み込む」をクリック
5. プロジェクトの`dist`フォルダを選択

## 使用方法

### 1. ウォレット作成
- 拡張機能アイコンをクリックしてウォレットを開く
- 「ウォレットを作成」を選択
- パスワードを設定してニーモニックフレーズを保存

### 2. DAppへの接続
- Web3対応のウェブサイトを訪問
- ウェブサイトが自動的にUniversal Walletを検出
- ウォレット接続ボタンをクリックして接続

### 3. トランザクション署名
- DAppがトランザクションを開始すると確認ウィンドウがポップアップ
- トランザクション詳細を確認して確認をクリック
- ウォレットが自動的に署名してトランザクションを送信

## DApp統合例

```javascript
// ウォレット検出
if (window.ethereum) {
  console.log('Universal Wallet detected')
}

// ウォレット接続
const accounts = await window.ethereum.request({
  method: 'eth_requestAccounts'
})

// トランザクション送信
const txHash = await window.ethereum.request({
  method: 'eth_sendTransaction',
  params: [{
    from: accounts[0],
    to: '0x...',
    value: '0x...',
    gasLimit: '0x5208'
  }]
})

// メッセージ署名
const signature = await window.ethereum.request({
  method: 'personal_sign',
  params: ['Hello World', accounts[0]]
})
```

## セキュリティ機能

- **ローカル暗号化ストレージ**: 秘密鍵とニーモニックフレーズをAES暗号化で保存
- **パスワード保護**: ウォレット操作にパスワード検証が必要
- **確認ポップアップ**: すべての署名操作にユーザー確認が必要
- **分離ストレージ**: Chrome拡張機能の独立したストレージ空間を使用

## 拡張機能

追加できる機能：
- **トークンサポート**: ERC-20トークン管理と転送
- **NFT表示**: ERC-721/ERC-1155 NFT管理
- **トランザクション履歴**: ローカルトランザクション記録の保存
- **アドレス帳**: よく使用するアドレスの管理
- **多言語**: 国際化サポート
- **ハードウェアウォレット**: Ledger/Trezor統合

## 重要な注意事項

1. **Infura設定**: `WalletManager.ts`で有効なInfura APIキーを設定する必要があります
2. **ネットワーク設定**: コードでより多くのEVM互換ネットワークを追加可能
3. **セキュリティ**: 本番環境使用前に十分なセキュリティ監査を実施
4. **テスト**: まずテストネットワークで十分なテストを行うことを推奨

このウォレット拡張機能は完全なWeb3ウォレット機能を実装し、DAppに標準のイーサリアムプロバイダサービスを提供できます。